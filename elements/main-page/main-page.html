<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../my-paper-material.html">
<link rel="import" href="../cross-stitch/cross-stitch.html">
<link rel="import" href="../palette-viewer/palette-viewer.html">
<link rel="import" href="../paper-file-upload/paper-file-upload.html">

<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">

<dom-module id="main-page">
  <style is="custom-style">
    :host {
      display: block;
    }
    paper-slider {
      width: 100%;
    }
    .indent {
      margin-left: 25px;
      margin-right: 25px;
    }
    #intro {
      border-bottom: #CCC 1px solid;
    }
    .buttonsContainer ::content > *{
      display: flex;
      flex-direction: row;
      justify-content: space-around;
    }

    @media screen and (max-width: 1200px) {
      .mobilehide{
        display: none;
      }
      .mobileshow {
        display: inherit;
      }
      .minsize {
        min-width: 450px;
      }
    }
    @media screen and (min-width: 1201px) {
      .mobilehide{
        display: inherit;
      }
      .mobileshow {
        display: none;
      }
    }
    @media screen and (max-width: 500px) {
      .minsize {
        min-width: 250px;
      }
    }
    @media screen and (max-width: 750px) {
      .buttonsContainer ::content > *{
        display: flex;
        flex-direction: column;
        align-items: stretch;
      }
      .buttonsContainer paper-button {
        margin-top: 10px;
        width: 100%;
      }
    }
  </style>
  <template>
    <section>
      <my-paper-material elevation="5" class="layout vertical">
        <div id="intro">
          <p>
            Stitchpics is your best way to turn any picture into a crossstitch pattern. No more
            tracing or drawing pictures by hand, in less than an minute you can have a picture
            ready for cross stitching.
          </p>
          <p>
            Simply choose any picture to upload, choose the Aida cloth count, the cross stitch
            size and number of colors and you're on your way to creating an amazing cross stitch
            for friends, family or even as an adornment for your home.
          </p>
        </div>
        <div class="layout horizontal wrap">
          <div class="minsize flex">
            <h3>Setup</h3>
            <my-paper-material elevation="1" class="indent">
              <div>Aida cloth count</div>
              <paper-slider min="6" max="24" step="2" value="{{clothCount}}" snaps pin editable></paper-slider>
              <div>Cross Stitch Size (in inches)</div>
              <paper-slider min="4" max="12" step="1" value="{{size}}" snaps pin editable></paper-slider>
              <div>Number of colors</div>
              <paper-slider min="4" max="32" step="4" value="{{numColors}}" snaps pin editable></paper-slider>
              <paper-file-upload id="imageUpload" imagedata="{{imageData}}"></paper-file-upload>
            </my-paper-material>

            <div class="mobilehide">
              <h3>Save</h3>
              <my-paper-material elevation="1" class="indent">
                <paper-button id="saveButton" raised on-tap="saveImage">Save As Image</paper-button>
                <paper-button id="newTabButton" raised on-tap="openNewTab" >Open In New Tab</paper-button>
                <paper-button id="printButton" raised on-tap="printImage">Print</paper-button>
              </my-paper-material>
            </div>

            <my-paper-material elevation="1" class="indent">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
              <!-- Main App Ad -->
              <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-8694540020289271"
                 data-ad-slot="4087460740"
                 data-ad-format="auto"></ins>
              <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
            </my-paper-material>
          </div>
          <div class="minsize flex">
            <h3>Cross Stitch</h3>
            <my-paper-material elevation="1" class="indent">
              <cross-stitch
                id="crossStitchElement"
                gridWidth="{{gridWidth}}"
                numColors="{{numColors}}"
                imageData="{{imageData}}"
                palette="{{palette}}">
              </cross-stitch>
            </my-paper-material>
            <h3>Colors Used</h3>
            <my-paper-material elevation="1" class="indent">
              <palette-viewer palette="[[palette]]"></palette-viewer>
            </my-paper-material>
            <div class="mobileshow">
              <h3>Save</h3>
              <my-paper-material elevation="1" class="indent buttonsContainer">
                <paper-button id="saveButton" raised on-tap="saveImage">Save As Image</paper-button>
                <paper-button id="newTabButton" raised on-tap="openNewTab">Open In New Tab</paper-button>
                <paper-button id="printButton" raised on-tap="printImage">Print</paper-button>
              </my-paper-material>
            </div>
          </div>
        </div>
      </my-paper-material>
    </section>
  </template>
</dom-module>
<script>
(function() {
  'use strict';
  /*jshint -W064 */
  Polymer({
  /*jshint +W064 */
    is: 'main-page',


    calcGridWidth: function calcGridWidth(clothCount, size){
      return clothCount * size;
    },

    saveImage: function saveImage(){
      this.$.crossStitchElement.saveAsImage();
    },

    getImageAsDataURI: function getImageAsDataURI(){
      var imageContainer = new Image();
      imageContainer.src = this.$.crossStitchElement.getImageAsURI();
      imageContainer.style['image-rendering']='pixelated';
      return imageContainer;
    },

    openNewTab: function openNewTab(){
      var imageContainer = this.getImageAsDataURI();
      imageContainer.style.width='100%';

      var newTab = window.open('');
      newTab.document.write(imageContainer.outerHTML);
    },

    printImage: function printImage(){
      var imageContainer = this.getImageAsDataURI();
      imageContainer.style.height = '100%';
      imageContainer.style.display = 'block';
      imageContainer.style.marginLeft = 'auto';
      imageContainer.style.marginRight = 'auto';
      imageContainer.style.marginTop = '0';
      imageContainer.style.marginBottom = '0';

      var newTab = window.open('');
      newTab.document.write(imageContainer.outerHTML);
      newTab.focus(); // Required for IE (if I ever support it...)
      newTab.print();
    },

    properties: {
      clothCount: {
        type: Number,
        value: 14
      },
      size: {
        type: Number,
        value: 6
      },
      numColors: {
        type: Number,
        value: 12
      },
      gridWidth: {
        type: Number,
        computed: 'calcGridWidth(clothCount, size)'
      },

    }
  });
})();
</script>
