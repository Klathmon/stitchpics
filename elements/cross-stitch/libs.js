"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&importScripts("../globalScripts/globalScripts.js"),function(){function t(t){if(t=t||{},this.method=t.method||2,this.colors=t.colors||256,this.initColors=t.initColors||4096,this.initDist=t.initDist||.01,this.distIncr=t.distIncr||.005,this.hueGroups=t.hueGroups||10,this.satGroups=t.satGroups||10,this.lumGroups=t.lumGroups||10,this.minHueCols=t.minHueCols||0,this.hueStats=this.minHueCols?new e(this.hueGroups,this.minHueCols):null,this.boxSize=t.boxSize||[64,64],this.boxPxls=t.boxPxls||2,this.palLocked=!1,this.dithKern=t.dithKern||null,this.dithSerp=t.dithSerp||!1,this.dithDelta=t.dithDelta||0,this.histogram={},this.idxrgb=t.palette?t.palette.slice(0):[],this.idxi32=[],this.i32idx={},this.i32rgb={},this.useCache=t.useCache!==!1,this.cacheFreq=t.cacheFreq||10,this.reIndex=t.reIndex||0==this.idxrgb.length,this.colorDist="manhattan"==t.colorDist?a:r,this.idxrgb.length>0){var i=this;this.idxrgb.forEach(function(t,e){var r=(255<<24|t[2]<<16|t[1]<<8|t[0])>>>0;i.idxi32[e]=r,i.i32idx[r]=e,i.i32rgb[r]=t})}}function e(t,e){this.numGroups=t,this.minCols=e,this.stats={};for(var i=-1;t>i;i++)this.stats[i]={num:0,cols:[]};this.groupsFull=0}function i(t,e,i){return Math.sqrt(v*t*t+x*e*e+m*i*i)}function r(t,e){var i=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.sqrt(v*i*i+x*r*r+m*a*a)/k}function a(t,e){var i=Math.abs(e[0]-t[0]),r=Math.abs(e[1]-t[1]),a=Math.abs(e[2]-t[2]);return(v*i+x*r+m*a)/D}function n(t,e,r){var a,n,s,o,h,u;if(t/=255,e/=255,r/=255,a=Math.max(t,e,r),n=Math.min(t,e,r),h=(a+n)/2,a==n)s=o=0;else{switch(u=a-n,o=h>.5?u/(2-a-n):u/(a+n),a){case t:s=(e-r)/u+(r>e?6:0);break;case e:s=(r-t)/u+2;break;case r:s=(t-e)/u+4}s/=6}return{h:s,s:o,l:i(t,e,r)}}function s(t,e){var i=1/e,r=i/2;if(t>=1-r||r>=t)return 0;for(var a=1;e>a;a++){var n=a*i;if(t>=n-r&&n+r>=t)return a}}function o(t){return t}function h(t){return t}function u(t){return Object.prototype.toString.call(t).slice(8,-1)}function l(t){var e=u(this[0]);if("Number"==e||"String"==e){for(var i,r={},a=this.length,n=0;a>n;n++)i=this[n],r[i]||0===r[i]||(r[i]=n);return this.sort(function(e,i){return t(e,i)||r[e]-r[i]})}var r=this.map(function(t){return t});return this.sort(function(e,i){return t(e,i)||r.indexOf(e)-r.indexOf(i)})}function c(){var t="abcdefghijklmnopqrstuvwxyz";return"xyzvwtursopqmnklhijfgdeabc"==t.split("").sort(function(e,i){return~~(t.indexOf(i)/2.3)-~~(t.indexOf(e)/2.3)}).join("")}function f(t,e){var i,r,a,n,s,o;switch(u(t)){case"HTMLImageElement":i=document.createElement("canvas"),i.width=t.naturalWidth,i.height=t.naturalHeight,r=i.getContext("2d"),r.drawImage(t,0,0);case"Canvas":case"HTMLCanvasElement":i=i||t,r=r||i.getContext("2d");case"CanvasRenderingContext2D":r=r||t,i=i||r.canvas,a=r.getImageData(0,0,i.width,i.height);case"ImageData":a=a||t,e=a.width,n="CanvasPixelArray"==u(a.data)?new Uint8Array(a.data):a.data;case"Array":case"CanvasPixelArray":n=n||new Uint8Array(t);case"Uint8Array":case"Uint8ClampedArray":n=n||t,s=new Uint32Array(n.buffer);case"Uint32Array":s=s||t,n=n||new Uint8Array(s.buffer),e=e||s.length,o=s.length/e}return{can:i,ctx:r,imgd:a,buf8:n,buf32:s,width:e,height:o}}function d(t,e,i,r){for(var a=t%i,n=e%r,s=t-a,o=e-n,h=[],u=0;e>u;u+=r)for(var l=0;t>l;l+=i)h.push({x:l,y:u,w:l==s?a:i,h:u==o?n:r});return h}function g(t,e,i){var r=t,a=r.y*e+r.x,n=(r.y+r.h-1)*e+(r.x+r.w-1),s=0,o=e-r.w+1,h=a;do i.call(this,h),h+=++s%r.w==0?o:1;while(n>=h)}function p(t,e){var i=[];for(var r in t)i.push(r);return C.call(i,function(i,r){return e?t[r]-t[i]:t[i]-t[r]})}t.prototype.sample=function(t,e){if(this.palLocked)throw"Cannot sample additional images, palette already assembled.";var i=f(t,e);switch(this.method){case 1:this.colorStats1D(i.buf32);break;case 2:this.colorStats2D(i.buf32,i.width)}},t.prototype.reduce=function(t,e,i,r){if(this.palLocked||this.buildPal(),i=i||this.dithKern,r=void 0!==r?r:this.dithSerp,e=e||1,i)var a=this.dither(t,i,r);else for(var n=f(t),s=n.buf32,o=s.length,a=new Uint32Array(o),h=0;o>h;h++){var u=s[h];a[h]=this.nearestColor(u)}if(1==e)return new Uint8Array(a.buffer);if(2==e){for(var l=[],o=a.length,h=0;o>h;h++){var u=a[h];l[h]=this.i32idx[u]}return l}},t.prototype.dither=function(t,e,i){var r={FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]],Jarvis:[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]],Burkes:[[.25,1,0],[.125,2,0],[2/32,-2,1],[.125,-1,1],[.25,0,1],[.125,1,1],[2/32,2,1]],Sierra:[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[.125,-1,1],[5/32,0,1],[.125,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]],TwoSierra:[[.25,1,0],[3/16,2,0],[1/16,-2,1],[.125,-1,1],[3/16,0,1],[.125,1,1],[1/16,2,1]],SierraLite:[[.5,1,0],[.25,-1,1],[.25,0,1]]};if(!e||!r[e])throw"Unknown dithering kernel: "+e;for(var a=r[e],n=f(t),s=n.buf32,o=n.width,h=n.height,u=(s.length,i?-1:1),l=0;h>l;l++){i&&(u=-1*u);for(var c=l*o,d=1==u?0:o-1,g=1==u?o:0;d!==g;d+=u){var p=c+d,v=s[p],x=255&v,m=(65280&v)>>8,w=(16711680&v)>>16,b=this.nearestColor(v),y=255&b,k=(65280&b)>>8,D=(16711680&b)>>16;if(s[p]=255<<24|D<<16|k<<8|y,this.dithDelta){var C=this.colorDist([x,m,w],[y,k,D]);if(C<this.dithDelta)continue}for(var S=x-y,P=m-k,E=w-D,I=1==u?0:a.length-1,A=1==u?a.length:0;I!==A;I+=u){var M=a[I][1]*u,_=a[I][2],G=_*o;if(M+d>=0&&o>M+d&&_+l>=0&&h>_+l){var U=a[I][0],W=p+(G+M),L=255&s[W],B=(65280&s[W])>>8,H=(16711680&s[W])>>16,z=Math.max(0,Math.min(255,L+S*U)),F=Math.max(0,Math.min(255,B+P*U)),q=Math.max(0,Math.min(255,H+E*U));s[W]=255<<24|q<<16|F<<8|z}}}}return s},t.prototype.buildPal=function(t){if(!(this.palLocked||this.idxrgb.length>0&&this.idxrgb.length<=this.colors)){var e=this.histogram,i=p(e,!0);if(0==i.length)throw"Nothing has been sampled, palette cannot be built.";switch(this.method){case 1:for(var r=this.initColors,a=i[r-1],n=e[a],s=i.slice(0,r),o=r,h=i.length;h>o&&e[i[o]]==n;)s.push(i[o++]);this.hueStats&&this.hueStats.inject(s);break;case 2:var s=i}s=s.map(function(t){return+t}),this.reducePal(s),!t&&this.reIndex&&this.sortPal(),this.useCache&&this.cacheHistogram(s),this.palLocked=!0}},t.prototype.palette=function(t,e){return this.buildPal(e),t?this.idxrgb:new Uint8Array(new Uint32Array(this.idxi32).buffer)},t.prototype.prunePal=function(t){for(var e,i=0;i<this.idxrgb.length;i++)t[i]||(e=this.idxi32[i],this.idxrgb[i]=null,this.idxi32[i]=null,delete this.i32idx[e]);if(this.reIndex){for(var r=[],a=[],n={},i=0,s=0;i<this.idxrgb.length;i++)this.idxrgb[i]&&(e=this.idxi32[i],r[s]=this.idxrgb[i],n[e]=s,a[s]=e,s++);this.idxrgb=r,this.idxi32=a,this.i32idx=n}},t.prototype.reducePal=function(t){if(this.idxrgb.length>this.colors){for(var e,i=t.length,r={},a=0,n=!1,s=0;i>s;s++)a!=this.colors||n||(this.prunePal(r),n=!0),e=this.nearestIndex(t[s]),a<this.colors&&!r[e]&&(r[e]=!0,a++);n||(this.prunePal(r),n=!0)}else{var o=t.map(function(t){return[255&t,(65280&t)>>8,(16711680&t)>>16]}),i=o.length,h=i,u=this.initDist;if(h>this.colors){for(;h>this.colors;){for(var l=[],s=0;i>s;s++){var c=o[s];t[s];if(c)for(var f=s+1;i>f;f++){var d=o[f],g=t[f];if(d){var p=this.colorDist(c,d);u>p&&(l.push([f,d,g,p]),delete o[f],h--)}}}u+=h>3*this.colors?this.initDist:this.distIncr}if(h<this.colors){C.call(l,function(t,e){return e[3]-t[3]});for(var v=0;h<this.colors;)o[l[v][0]]=l[v][1],h++,v++}}for(var i=o.length,s=0;i>s;s++)o[s]&&(this.idxrgb.push(o[s]),this.idxi32.push(t[s]),this.i32idx[t[s]]=this.idxi32.length-1,this.i32rgb[t[s]]=o[s])}},t.prototype.colorStats1D=function(t){for(var e,i=this.histogram,r=t.length,a=0;r>a;a++)e=t[a],(4278190080&e)>>24!=0&&(this.hueStats&&this.hueStats.check(e),e in i?i[e]++:i[e]=1)},t.prototype.colorStats2D=function(t,e){var i=this.boxSize[0],r=this.boxSize[1],a=i*r,n=d(e,t.length/e,i,r),s=this.histogram,o=this;n.forEach(function(i){var r,n=Math.max(Math.round(i.w*i.h/a)*o.boxPxls,2),h={};g(i,e,function(e){r=t[e],(4278190080&r)>>24!=0&&(o.hueStats&&o.hueStats.check(r),r in s?s[r]++:r in h?++h[r]>=n&&(s[r]=h[r]):h[r]=1)})}),this.hueStats&&this.hueStats.inject(s)},t.prototype.sortPal=function(){var t=this;this.idxi32.sort(function(e,i){var r=t.i32idx[e],a=t.i32idx[i],u=t.idxrgb[r],l=t.idxrgb[a],c=n(u[0],u[1],u[2]),f=n(l[0],l[1],l[2]),d=u[0]==u[1]&&u[1]==u[2]?-1:s(c.h,t.hueGroups),g=l[0]==l[1]&&l[1]==l[2]?-1:s(f.h,t.hueGroups),p=g-d;if(p)return-p;var v=h(+f.l.toFixed(2))-h(+c.l.toFixed(2));if(v)return-v;var x=o(+f.s.toFixed(2))-o(+c.s.toFixed(2));return x?-x:void 0}),this.idxi32.forEach(function(e,i){t.idxrgb[i]=t.i32rgb[e],t.i32idx[e]=i})},t.prototype.nearestColor=function(t){var e=this.nearestIndex(t);return null===e?0:this.idxi32[e]},t.prototype.nearestIndex=function(t){if((4278190080&t)>>24==0)return null;if(this.useCache&&""+t in this.i32idx)return this.i32idx[t];for(var e,i=1e3,r=[255&t,(65280&t)>>8,(16711680&t)>>16],a=this.idxrgb.length,n=0;a>n;n++)if(this.idxrgb[n]){var s=this.colorDist(r,this.idxrgb[n]);i>s&&(i=s,e=n)}return e},t.prototype.cacheHistogram=function(t){for(var e=0,i=t[e];e<t.length&&this.histogram[i]>=this.cacheFreq;i=t[e++])this.i32idx[i]=this.nearestIndex(i)},e.prototype.check=function(t){this.groupsFull==this.numGroups+1&&(this.check=function(){});var e=255&t,i=(65280&t)>>8,r=(16711680&t)>>16,a=e==i&&i==r?-1:s(n(e,i,r).h,this.numGroups),o=this.stats[a],h=this.minCols;o.num++,o.num>h||(o.num==h&&this.groupsFull++,o.num<=h&&this.stats[a].cols.push(t))},e.prototype.inject=function(t){for(var e=-1;e<this.numGroups;e++)if(this.stats[e].num<=this.minCols)switch(u(t)){case"Array":this.stats[e].cols.forEach(function(e){-1==t.indexOf(e)&&t.push(e)});break;case"Object":this.stats[e].cols.forEach(function(e){t[e]?t[e]++:t[e]=1})}};var v=.2126,x=.7152,m=.0722,w=255,b=255,y=255,k=Math.sqrt(v*w*w+x*b*b+m*y*y),D=v*w+x*b+m*y,C=c()?Array.prototype.sort:l;this.RgbQuant=t,"undefined"!=typeof module&&module.exports&&(module.exports=t)}.call(this),function(){"use strict";var t={_convertToRealImageData:function(t){var e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height);return e.data.set(t.data),e},_readImageData:function(t){var e=t.getContext("2d");return e.getImageData(0,0,t.width,t.height)},_writeImageData:function(t,e){t.height=e.height,t.width=e.width;var i=t.getContext("2d");return i.putImageData(e,0,0),i},_catchErrors:function(t){console.error(t.stack)}};self.miscBehavior=t}(),function(){"use strict";var t={scale:function(t){var e=this,i=t.imageData,r=t.newWidth;return new Promise(function(t){var a=r/i.width,n=document.createElement("canvas"),s=n.getContext("2d");n.width=i.width*a,n.height=i.height*a;var o=document.createElement("canvas");e._writeImageData(o,i),s.scale(a,a),s.drawImage(o,0,0),t(s.getImageData(0,0,n.width,n.height))})},splitGenerator:regeneratorRuntime.mark(function e(t){var i,r,a,n,s,o,h,u,l,c,f=t.imageData,d=t.numberOfParts,g=t.pixelHeight;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=f.data,r=f.width,a=f.height,n=Math.floor(a/d),s=Math.ceil(n/g),o=s*g,h=document.createElement("canvas"),u=h.getContext("2d"),this._writeImageData(h,f),l=0;case 10:if(!(d>l)){t.next=18;break}return c=l*o,l===d-1&&(o=a-o*l),t.next=15,{chunk:u.getImageData(0,c,r,o),chunkStartY:c};case 15:l++,t.next=10;break;case 18:case"end":return t.stop()}},e,this)}),stitch:function(t){var e=t.chunks,i=t.canvas,r=e[0].width,a=e.reduce(function(t,e){return t+e.height},0);i.width=r,i.height=a;var n=i.getContext("2d");e.forEach(function(t,i){var r=i*e[0].height;n.putImageData(t,0,r)},this)}};self.sizingBehavior=t}(),function(){"use strict";var t={buildPalette:function(t){var e=this,i=t.imageData,r=t.numColors,a=t.useDmcColors;return new Promise(function(t){var n={colors:r,colorDist:"euclidean",method:1,initColors:a?e._getDmcColorMap().size:2048,useCache:!1,palette:a?e._getColorsAsRGB():void 0,reIndex:!0},s=new RgbQuant(n);s.sample(i);var o=s.palette(!0);t({imageData:i,palette:o},[i.data.buffer])})},quantize:function(t){var e=this,i=t.imageData,r=t.palette,a=t.useDmcColors;return new Promise(function(t){var n={colorDist:"euclidean",method:1,initColors:a?e._getDmcColorMap().size:2048,useCache:!1,palette:r},s=new RgbQuant(n),o={data:new Uint8ClampedArray(s.reduce(i,1)),width:i.width,height:i.height};t({imageData:o},[i.data.buffer])})}};self.quantizeBehavior=t}();var _slicedToArray=function(){function t(t,e){var i=[],r=!0,a=!1,n=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(h){a=!0,n=h}finally{try{!r&&o["return"]&&o["return"]()}finally{if(a)throw n}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){"use strict";var t={pixelate:function(t){var e=this,i=t.imageData,r=t.pixelWidth,a=t.pixelHeight,n=t.xPixels,s=t.yPixels,o=t.hideTheGrid;return new Promise(function(t){e.isLittleEndian=e._isLittleEndian();for(var h=0;n>h;h++)for(var u=0;s>u;u++){var l=e._getMode({imageData:i,pixelX:h,pixelY:u,pixelWidth:r,pixelHeight:a,xPixels:n,yPixels:s});e._setSuperPixelColor({imageData:i,pixelX:h,pixelY:u,pixelWidth:r,pixelHeight:a,xPixels:n,yPixels:s,color:l,hideTheGrid:o})}t({imageData:i},[i.data.buffer])})},_getMode:function(t){for(var e=t.imageData,i=t.pixelX,r=t.pixelY,a=t.pixelWidth,n=t.pixelHeight,s=(t.xPixels,t.yPixels,e.data),o=e.width,h=e.height,u=new Uint32Array(s.buffer),l=this.isLittleEndian,c=new Map,f=null,d=1,g=0;a>g;g++)for(var p=0;n>p;p++){var v=i*a+g,x=r*n+p;if(o>v&&h>x){var m=u[x*o+v|0];0===g&&0===p&&(f=m),c.has(m)?c.set(m,c.get(m)+1):c.set(m,1),c.get(m)>d&&(f=m,d=c.get(m))}}return null===f?[0,0,0,0]:this._getPixelEndianSafe(l,f)},_setSuperPixelColor:function(t){for(var e=t.imageData,i=t.pixelX,r=t.pixelY,a=t.pixelWidth,n=t.pixelHeight,s=(t.xPixels,t.yPixels,t.color),o=t.hideTheGrid,h=e.data,u=e.width,l=e.height,c=new Uint32Array(h.buffer),f=this.isLittleEndian,d=_slicedToArray(s,4),g=d[0],p=d[1],v=d[2],x=d[3],m=0;a>m;m++)for(var w=0;n>w;w++){var b=i*a+m,y=r*n+w;if(u>b&&l>y){var k=y*u+b|0;o||m!==a-1&&w!==n-1?200>x?c[k]=0:c[k]=this._setPixelEndianSafe(f,g,p,v,255):c[k]=this._setPixelEndianSafe(f,50,50,50,255)}}},_setPixelEndianSafe:function(t,e,i,r,a){return t?a<<24|r<<16|i<<8|e:e<<24|i<<16|r<<8|a},_getPixelEndianSafe:function(t,e){return t?[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]:[(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},_isLittleEndian:function(){var t=new ArrayBuffer(12),e=new Uint32Array(t);return e[1]=168496141,10===t[4]&&11===t[5]&&12===t[6]&&13===t[7]?!1:!0}};self.pixelateBehavior=t}(),function(){"use strict";var t={properties:{workers:{type:Array,value:[]}},createWorkers:function(t,e){this.workers=_.times(e,function(){return{working:!1,worker:new Worker(this.resolveUrl(t))}},this)},dispatchWorker:function(t,e,i){var r=this;return new Promise(function(a){var n=function s(t,e,i){var n=_.findWhere(r.workers,{working:!1});if(void 0===n)setTimeout(s,100,t,e,i);else{n.working=!0;var o=function h(t){n.worker.removeEventListener("message",h,!1),n.working=!1,a(t.data)};n.worker.addEventListener("message",o,!1),n.worker.postMessage({func:t,data:e},i)}};n(t,e,i)})},receiveWork:function(t){var e=t.data,i=e.func,r=e.data,a=_.merge(self.workerBehavior,self.sizingBehavior,self.quantizeBehavior,self.pixelateBehavior,self.miscBehavior,self.dmcColorBehavior);a[i].call(a,r).then(function(t,e){self.postMessage(t,e)})["catch"](a._catchErrors)}};self.workerBehavior=t,"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self.addEventListener("message",self.workerBehavior.receiveWork,!1)}();