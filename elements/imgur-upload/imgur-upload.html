<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="imgur-upload">
  <style>:host{font-family:Roboto,Noto,sans-serif;display:block}</style>
  <template>
    <paper-button raised="" on-tap="uploadImage">Get Link</paper-button>

    <paper-dialog id="saveDialog" modal="" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2>Save Link</h2>
      <div>
        <paper-input id="shareInput" label="Use this link to share your pattern"></paper-input>
      </div>
      <div class="buttons">
          <paper-button dialog-confirm="" raised="">Done</paper-button>
      </div>
    </paper-dialog>
  </template>
</dom-module>

<script>!function(){"use strict";Polymer({is:"imgur-upload",properties:{uploadEndpoint:{type:String,value:"https://api.imgur.com/3/image.json"},clientId:{type:String,value:"12a81bf09a70960"},imagedata:{type:Array}},uploadImage:function(){var t=this;fetch(this.uploadEndpoint,{method:"post",mode:"cors",headers:{Authorization:"Client-ID "+this.clientId,Accept:"application/json","Content-type":"application/json; charset=UTF-8"},body:JSON.stringify({image:this.getBase64FromImageData(this.imagedata).replace(/.*,/,""),type:"base64"})}).then(function(t){return t.json()}).then(function(e){console.log(e),t.$.shareInput.value=window.location.origin+"/"+e.data.id,t.$.saveDialog.open()})["catch"](function(t){console.log(t)})},getBase64FromImageData:function(t){var e=document.createElement("canvas");e.height=t.height,e.width=t.width;var a=e.getContext("2d");return a.putImageData(t,0,0),e.toDataURL()}})}();</script>
